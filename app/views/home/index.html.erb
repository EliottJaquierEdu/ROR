<% content_for :title, "School Management System" %>

<% if person_signed_in? %>
  <div class="jumbotron bg-light p-5 mb-4 rounded shadow-sm">
    <h1 class="display-4">Welcome to the School Management System</h1>
    <p class="lead">
      <% if current_person.dean? %>
        Manage your school's students, teachers, classes, courses, and more with ease.
      <% elsif current_person.teacher? %>
        Manage your classes, examinations, and student grades with ease.
      <% elsif current_person.student? %>
        View your classes, examinations, and grades with ease.
      <% else %>
        Manage your school's students, teachers, classes, courses, and more with ease.
      <% end %>
    </p>
    <hr class="my-4">
    <p>Use the navigation above to access different sections of the application.</p>
  </div>

  <div class="row mb-4">
    <% if @students.any? %>
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0"><i class="bi bi-mortarboard"></i> Students</h5>
              <span class="badge bg-light text-primary"><%= @students.count %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="list-group list-group-flush">
              <% @students.take(5).each do |student| %>
                <%= link_to person_path(student), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
                  <%= student.full_name %>
                  <% if student.school_classes.any? %>
                    <span class="badge bg-info rounded-pill"><%= student.school_classes.count %> classes</span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <% if @students.count > 5 && can_view_all_students? %>
              <div class="text-center mt-3">
                <%= link_to people_path(type: "Student"), class: "btn btn-sm btn-outline-primary" do %>
                  <i class="bi bi-list"></i> View all students
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @teachers.any? %>
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-warning text-dark">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0"><i class="bi bi-person-workspace"></i> Teachers</h5>
              <span class="badge bg-light text-warning"><%= @teachers.count %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="list-group list-group-flush">
              <% @teachers.take(5).each do |teacher| %>
                <%= link_to person_path(teacher), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
                  <%= teacher.full_name %>
                  <% if teacher.school_classes.any? %>
                    <span class="badge bg-warning text-dark rounded-pill"><%= teacher.school_classes.count %> classes</span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <% if @teachers.count > 5 && can_view_all_teachers? %>
              <div class="text-center mt-3">
                <%= link_to people_path(type: "Teacher"), class: "btn btn-sm btn-outline-warning" do %>
                  <i class="bi bi-list"></i> View all teachers
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @school_classes.any? %>
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0"><i class="bi bi-building"></i> School Classes</h5>
              <span class="badge bg-light text-success"><%= @school_classes.count %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="list-group list-group-flush">
              <% @school_classes.take(5).each do |school_class| %>
                <%= link_to school_class_path(school_class), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
                  <%= "#{school_class.year}-#{school_class.name}" %>
                  <% if school_class.students.any? %>
                    <span class="badge bg-success rounded-pill"><%= school_class.students.count %> students</span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <% if @school_classes.count > 5 && can_view_all_school_classes? %>
              <div class="text-center mt-3">
                <%= link_to school_classes_path, class: "btn btn-sm btn-outline-success" do %>
                  <i class="bi bi-list"></i> View all classes
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="row">
    <% if @subjects.any? %>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-info text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0"><i class="bi bi-journal-text"></i> Subjects</h5>
              <span class="badge bg-light text-info"><%= @subjects.count %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="list-group list-group-flush">
              <% @subjects.order(:name).take(5).each do |subject| %>
                <%= link_to subject_path(subject), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
                  <%= subject.name %>
                  <% if subject.courses.any? %>
                    <span class="badge bg-info rounded-pill"><%= subject.courses.count %> courses</span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <% if @subjects.count > 5 && can_view_all_subjects? %>
              <div class="text-center mt-3">
                <%= link_to subjects_path, class: "btn btn-sm btn-outline-info" do %>
                  <i class="bi bi-list"></i> View all subjects
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @examinations.any? %>
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-secondary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0"><i class="bi bi-clipboard-check"></i> Examinations</h5>
              <span class="badge bg-light text-secondary"><%= @examinations.count %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="list-group list-group-flush">
              <% @examinations.take(5).each do |examination| %>
                <%= link_to examination_path(examination), class: "list-group-item list-group-item-action" do %>
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1"><%= examination.title %></h6>
                    <small><%= examination.expected_date&.strftime("%d %b %Y") %></small>
                  </div>
                  <% if examination.course&.subject %>
                    <small class="text-muted"><%= examination.course.subject.name %></small>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <% if @examinations.count > 5 && can_view_all_examinations? %>
              <div class="text-center mt-3">
                <%= link_to examinations_path, class: "btn btn-sm btn-outline-secondary" do %>
                  <i class="bi bi-list"></i> View all examinations
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="jumbotron bg-light p-5 mb-4 rounded shadow-sm text-center">
    <h1 class="display-4">Welcome to the School Management System</h1>
    <p class="lead">Please sign in to access the system.</p>
    <hr class="my-4">
    <div class="d-grid gap-2 col-6 mx-auto">
      <%= link_to "Sign In", new_person_session_path, class: "btn btn-primary btn-lg" %>
    </div>
  </div>
<% end %>
